<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="OctopusLAB" /><link rel="canonical" href="https://docs.octopuslab.cz/basicdoc/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Referenƒçn√≠ p≈ô√≠ruƒçka - OctopusLab</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Referen\u010dn\u00ed p\u0159\u00edru\u010dka";
        var mkdocs_page_input_path = "basicdoc.md";
        var mkdocs_page_url = "/basicdoc/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "UA-171553408-2", "docs.octopuslab.cz");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> OctopusLab
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">√övod</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">OctopusLAB</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../esp32/">ESP32</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../framework/">Octopus Framework</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Instalace</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../install/">Spoleƒçn√° ƒç√°st</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../install_win/">Windows </a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../install_linux/">Linux </a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../install_mac/">Mac </a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../setup/">Setup (nastaven√≠)</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Dokumentace</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Referenƒçn√≠ p≈ô√≠ruƒçka</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#moduly-tridy-funkce">Moduly, t≈ô√≠dy, funkce</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#knihovny-components-utils-lib">Knihovny (components | utils | lib)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#adresarova-strukrura-na-esp32">Adres√°≈ôov√° strukrura na ESP32</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#soubory-bootpy-a-mainpy">Soubory boot.py a main.py</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#bootpy">‚Ä¢ boot.py</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#mainpy">‚Ä¢ main.py</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#octopus-components">OCTOPUS Components</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#led">Led</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#rgb">Rgb</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#analog">Analog</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#button">Button</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#display7">Display7</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#oled">Oled</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#buzzer">Buzzer</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#servo">Servo</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#pca9685">pca9685</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#dcmotors">DCmotors</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#iot">IoT</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#octopus-utils">OCTOPUS Utils</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#wificonnect">WiFiConnect</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#bits">Bits</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#transform">Transform</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#database">Database</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mqtt">MQTT</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#influxdb">InfluxDB</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#octopus-lib">OCTOPUS Lib</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#lcd">LCD</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#st7735">ST7735</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#hcsr04">hcsr04</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#pubsub">pubsub</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ble">BLE</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#mobilni-aplikace-pro-ble">Mobiln√≠ aplikace pro BLE</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ostatni-podpurne-moduly">Ostatn√≠ podp≈Ørn√© moduly</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#config">Config</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#jednotlive-metody-pro-zakladni-varianty-pouzivani">Jednotliv√© metody pro z√°kladn√≠ varianty pou≈æ√≠v√°n√≠:</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#octopus_lib">octopus_lib</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#i2c">I2C</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#spi">SPI</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#rtc">RTC</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#pinout">pinout</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#dekorator">Dekor√°tor</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zrychleni-prace-procesoru">Zrychlen√≠ pr√°ce procesoru</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#web-server-ide-jednoduche-ovladani">Web server - IDE - jednoduch√© ovl√°d√°n√≠</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#web-server">Web server</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pinouts/">Pinouts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pubsub/">Pubsub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../upyshell/">UpyShell</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../examples/">Examples - uk√°zky</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../class/">Class</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutori√°ly</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tutorial1-python/">Tutorial 1 Python </a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tutorial2-micropython-esp/">Tutorial 2 Micropython ESP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tutorial-edukit1/">Tutorial EDUkit1</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tutorial-edukit2/">Tutorial EDUkit2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tutorial-robot/">Tutorial Robot</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ws-iot/">Micropython workshop IoT</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ws-robot/">Micropython workshop Robot</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ws-upyshell/">Upyshell workshop </a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ws-games/">workshop GAME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ws-python-data/">Python data</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Dal≈°√≠</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../esp-ide/">Pr√°ce s ESP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../github/">Github </a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../extension/">Roz≈°√≠≈ôen√≠ </a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../repl/">REPL</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../webserver/">WebServer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mqtt/">MQTT</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tutorials-intro/">Popis markdown</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">OctopusLab</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Dokumentace</li>
      <li class="breadcrumb-item active">Referenƒçn√≠ p≈ô√≠ruƒçka</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/octopuslab-cz/docs_octopuslab_cz/blob/master/docs/basicdoc.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="dokumentace"><img alt="logo" src="../img/logo_small.png" style="width:39px" /> Dokumentace</h1>
<p>Toto je hlavn√≠ ƒç√°st dokumentace, popisuj√≠c√≠ <strong>co a jak</strong>.
V dal≈°√≠ch ƒç√°stech, p≈ôedev≈°√≠m pak v odd√≠le <strong>Workshopy / tutori√°ly</strong> se pak dozv√≠te <strong>jak na to</strong>.</p>
<p>Origin√°ln√≠ dokumentaci k MicroPythonu najdete na str√°nk√°ch ü°í <a href="http://docs.micropython.org/en/latest/esp32/quickref.html">docs.micropython/esp32</a></p>
<hr />
<h2 id="moduly-tridy-funkce">Moduly, t≈ô√≠dy, funkce</h2>
<div class="admonition attention">
<p class="admonition-title">Z√°klad pro dal≈°√≠ pochopen√≠ (Micro)Pythonu</p>
<p>T√©mƒõ≈ô v≈°e v Pythonu je objekt. <strong>Objekt</strong> je kolekce dat (promƒõnn√Ωch) a <strong>metod</strong> (funkc√≠), kter√© s dan√Ωmi daty pracuj√≠. Prototypem objekt≈Ø jsou <strong>t≈ô√≠dy</strong>, z nich≈æ jsou v≈°echny <strong>objekty</strong> (ƒç√≠sla, ≈ôetƒõzce, funkce, moduly, metody, atp) odvozeny coby <strong>instance</strong>.
Pokud v√°m to nen√≠ jasn√©, trochu podrobnƒõji se o tom rozepisujeme na samostatn√© str√°nce: <a href="/class">class()</a>.
Pro spr√°vn√© pochopen√≠ a p≈ôedev≈°√≠m v kontextu pr√°ce s hardware zaƒç√°teƒçn√≠k≈Øm doporuƒçujeme zm√≠nƒõn√Ω odkaz alespo≈à letmo nav≈°t√≠vit.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Toto nen√≠ v√Ωuka programov√°n√≠ ‚Äì ale jen uk√°zky a experimenty s p≈ôihl√©dnut√≠m na sadu knihoven a modul≈Ø <strong>octopusLab</strong> pro pr√°ci s vybran√Ωm HW.</p>
<p>Pro podrobnƒõj≈°√≠ proniknut√≠ do taj≈Ø programov√°n√≠ v Pythonu doporuƒçujeme: </p>
<ul>
<li><a href="https://naucse.python.cz/">naucse.python.cz</a></li>
<li><a href="https://naucse.python.cz/course/mi-pyt/intro/micropython/">naucse.python.cz/course/mi-pyt/intro/micropython</a></li>
<li><a href="http://howto.py.cz/index.htm">howto.py.cz</a></li>
</ul>
</div>
<hr />
<h3 id="knihovny-components-utils-lib">Knihovny (components | utils | lib)</h3>
<p>Jednotliv√© moduly - knihovny (podprogramy, t≈ô√≠dy) jsme rozdƒõlili do nƒõkolika z√°kladn√≠ch adres√°≈ô≈Ø:</p>
<ul>
<li>
<p><a href="#octopus-components">/components</a>, kam postupnƒõ p≈ôid√°v√°me jednotliv√© "osamostatnƒõl√©" komponenty.</p>
</li>
<li>
<p><a href="#octopus-lib">/lib</a>, kde jsou p≈ôev√°≈ænƒõ knihovny t≈ôet√≠ch stran, a mal√© fragmenty, kter√© maj√≠ v√Ωhodu, ≈æe se p≈ôi importu v adres√°≈ôi lib hledaj√≠, <strong>Micropython</strong> je nalezne bez ud√°n√≠ cesty k nim.</p>
</li>
<li>
<p><a href="#octopus-utils">/utils</a>, (utility) moduly octopusLAB, a t≈ô√≠dy pro pr√°ci s periferiemi.</p>
</li>
</ul>
<p><em>U≈æivatele vlastnƒõ nemus√≠ zaj√≠mat, kde to je ulo≈æeno, a tak na to d≈Øraz neklademe, jen je vhodn√© si to pohl√≠dat p≈ôi sestavov√°n√≠ vƒõt≈°√≠ch projekt≈Ø.</em></p>
<div class="admonition hint">
<p class="admonition-title"><strong>Zdroje programov√©ho k√≥du</strong></p>
<p><code>Github</code> =&gt; <code>stable.tar</code> =&gt; <code>docs</code></p>
<p>Na≈°√≠ snahou je udr≈æet v souladu zdroj z githubu: <a href="https://github.com/octopusengine/octopuslab/tree/master/esp32-micropython">github.com/octopusengine/octopuslab</a>, kter√Ω se po <em>kompilaci a komprimaci</em> stane <a href="/install/#system-download-deploy">stable.tar</a> a k nƒõmu udr≈æovat aktu√°ln√≠ <strong>dokumentaci</strong>.</p>
</div>
<hr />
<h3 id="adresarova-strukrura-na-esp32">Adres√°≈ôov√° strukrura na ESP32</h3>
<pre>
|-- <a href="#soubory-bootpy-a-mainpy">boot.py</a>       # inicializace po startu
|      |-- <a href="#reset">reset</a>
|-- <a href="#soubory-bootpy-a-mainpy">main.py</a>       # hlavn√≠ soubor programu
|-- /assets       # obr√°zky, zvuky, tabulky
|-- <a href="#config">/config</a>       # kofiguraƒçn√≠ soubory (.json)
|-- <a href="#octopus-lib">/lib</a>          # obecnƒõ dostupn√° knihovna (lib)
|      |-- <a href="#pubsub">pubsub</a>
|      |-- <a href="/ftp">FTP</a>
|      |-- <a href="#BLE">/blesync_uart</a>
|      |-- ...
|      |-- /bmp280   # i2c Atmospheric pressure sensor
|      |-- /bh1750   # i2c Light sensor
|      |-- <a href="#st7735">ST7735.py</a> # TFT128*166 color display
|      |-- colors_rgb.py
|      |-- <a href="#hcsr04">hcsr04.py</a> # ultrasonic
|      |-- <a href="#lcd">lcd</a>
|      |-- ...
|
|-- <a href="#octopus-components">/components</a>
|      |-- <a href="#led">led</a>
|      |-- <a href="#rgb">rgb</a>
|      |-- <a href="#analog">analog</a>
|      |-- <a href="#button">button</a>
|      |-- <a href="#display7">display7</a>
|      |-- <a href="#oled">oled</a>
|      |-- <a href="#buzzer">buzzer</a>
|      |-- <a href="#servo">servo</a>
|      |-- <a href="#dcmotors">dcmotors</a>
|      |-- [plc]
|      |-- <a href="#iot">iot</a>
|            | Relay | PWM | Thermometer
|
|-- <a href="#octopus-utils">/utils</a>
|      |-- <a href="/setup">setup</a>
|      |-- <a href="#octopus_lib">octopus_lib</a>
|            | <a href="#i2c">I2C</a> | <a href="#spi">SPI</a> | <a href="#lcd">LCD</a> | <a href="#rtc">RTC</a> | ...
|      |-- <a href="#wificonnect">WiFiConnect</a>
|      |-- <a href="#pinout">pinout</a>
|      |-- <a href="#bits">bits</a>
|      |-- <a href="#transform">transform</a>
|      |-- <a href="#database">database</a>
|      |-- <a href="#mqtt">mqtt</a>
|      |-- octopus # WorkFrame with WebServer
|      |-- ...
|      |-- BLE
|
|-- <a href="/pinouts">/pinouts</a>      # nastaven√≠ pin≈Ø
|-- <a href="/examples">/examples</a>      # uk√°zky
|      |-- /asyncio
|      |-- /ble
|      |-- /param
|      |-- /pubsub
|      |-- blink.py
|      |-- ...
|
|-- /tests
|
|-- /shell
|      |-- <a href="/upyshell">shell</a>
|      |-- <a href="/upyshell/#editor">editor</a>
|-- ...
</pre>

<div class="admonition warning">
<p class="admonition-title"><strong>Pozor</strong></p>
<p><strong>Pokud jste pou≈æ√≠vali n√°≈° syst√©m u≈æ v roce 2019</strong>, p≈ôeinstalujte si na novou verzi. Velk√° ƒç√°st syst√©mu by v√°m u≈æ nefungovala. Od t√© doby do≈°lo toti≈æ k ≈ôadƒõ zmƒõn. P≈ôedev≈°√≠m byly t≈ôi z√°sadn√≠ verze Micropythonu, kde se mƒõnil i form√°t "kompilovan√Ωch" soubor≈Ø <code>.mpy</code>, kter√© jsou z√°kladem na≈°√≠ distribuce. Tak√© se doplnilo <code>BLE</code> pro pr√°ci s <strong>BlueTooth low energy</strong>.
A dal≈°√≠ zmƒõnou byla velk√° <code>refaktorizace</code> syst√©mu <strong>octopus</strong>, kde podardes√°≈ô <code>util</code> byl rozdƒõlen na <code>utils</code> (pro SW utility a hlavn√≠ framework) a <code>components</code> (kde jsou p≈ôev√°≈ænƒõ knihovny pro hw komponenty a periferie.) Tak√© <code>shell</code> byl p≈ôesunut z <code>util/shell</code> do rootu.</p>
</div>
<h3 id="soubory-bootpy-a-mainpy">Soubory boot.py a main.py</h3>
<h4 id="bootpy">‚Ä¢ boot.py</h4>
<p>je soubor, kter√Ω se spou≈°t√≠ jako prvn√≠ po bezprost≈ôen√≠m startu nebo po resetu ESP. Zpravidla ho nemƒõn√≠me. Mƒõl by obsahovat z√°kladn√≠ obecnou inicializaci. My tam m√°me p≈ôedev≈°√≠m definice cest k modul≈Øm:</p>
<pre><code class="language-python"># boot.py
def setup():
    import utils.setup
    utils.setup.setup()

def octopus():
    import utils.octopus
    utils.octopus.octopus()
    return utils.octopus

def reset():
    from machine import reset
    reset()

def shell():
    import shell
    shell.shell()
</code></pre>
<h5 id="reset">Reset</h5>
<p>Pro zjednodu≈°en√© pou≈æit√≠ resetu pomoc√≠ p≈ô√≠kazu <code>reset()</code> je v <code>boot.py</code> p≈ôednastaveno:</p>
<pre><code class="language-python">def reset():
    from machine import reset
    reset()
</code></pre>
<hr />
<h4 id="mainpy">‚Ä¢ main.py</h4>
<p>je hlavn√≠ soubor u≈æivatelsk√©ho programu, kter√Ω budeme vyu≈æ√≠vat pro sv√© projekty. Spust√≠ se (pokud existuje) hned po <code>boot.py</code>.
ƒåasto pou≈æ√≠v√°me jednoduch√© kop√≠rov√°n√≠ existuj√≠c√≠ho programu nebo uk√°zky (z examples) v prost≈ôed√≠ <a href="/upyshell">uPyshell</a>:</p>
<pre><code class="language-batch">$ cp examples/blink.py main.py

</code></pre>
<hr />
<h2 id="octopus-components">OCTOPUS Components</h2>
<h3 id="led"><img alt="hwsoc" src="../img/hwsoc.png" style="width:28px" /> Led</h3>
<p>T≈ô√≠da <code>Led</code> je vlastnƒõ jen jednoduch√Ωm roz≈°√≠≈ôen√≠m t≈ô√≠dy <code>Pin</code>.
Parametr p≈ôi vytv√°≈ôen√≠ instance je ƒç√≠slo pinu. <code>led = Led(2)</code>
P≈ôidali jsme k z√°kladn√≠ metodƒõ <code>value()</code> dal≈°√≠ch nƒõkolik metod: <code>toggle()</code>, <code>blink()</code> </p>
<p>Zdrojov√Ω k√≥d knihovny:
<a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/components/led/__init__.py">./components/led</a></p>
<p>Nejkrat≈°√≠ varianta pou≈æit√≠ je sice s vyu≈æ√≠t√≠m <code>utils</code>:</p>
<pre><code class="language-python">from utils.octopus import led
led.value(1)
</code></pre>
<p>Ale pro projekt lep≈°√≠ verze je s <code>components</code> (≈°et≈ô√≠ pamƒõ≈•, proto≈æe nanaƒç√≠t√° "cel√Ω octopus"):</p>
<pre><code class="language-python">from components.led import Led
led = Led(2)

while True:
    led.blink()
</code></pre>
<pre><code class="language-python">dir(led)
['class', 'init', 'module', 'qualname', 'value', 'dict', 'pin', 'blink', 'toggle', 'state']

&gt;&gt;&gt; led.pin
&gt; Pin(2)
&gt;&gt;&gt; led.state
&gt; False
&gt;&gt;&gt; led.value(1) # sv√≠t√≠
&gt;&gt;&gt; led.state    # info o stavu
1
</code></pre>
<p><strong>. TAB nab√≠dka metod:</strong> 
Micropython m√° obrovskou v√Ωhodu v tom, ≈æe bƒõ≈æ√≠ jako interpret: kdy≈æ u≈æivatel nap√≠≈°e n√°zev promƒõnn√© nebo instance objektu, skoro v≈°echno se o nich m≈Ø≈æeme dozvƒõdƒõt. Napi≈°te <code>led</code> pak <code>.</code> (teƒçka) a stisknƒõte <code>TAB</code>:</p>
<pre><code>led.
class       init        module      qualname
value       dict        pin         blink
toggle      state
</code></pre>
<div class="admonition note">
<p class="admonition-title"><strong>note</strong></p>
<p>Pro obecnƒõj≈°√≠ pr√°ci s vyu≈æit√≠m <code>set_pinout()</code> (p≈ôeddefinovan√Ωch <a href="/#pinout">pin≈Ø</a>) a <code>io_config</code> p≈ôedpokl√°d√°me, ≈æe pro <a href="/framework">Octopus FrameWork</a> m√°te pomoc√≠ <a href="/setup">setup()</a> nastavenu desku <code>ds</code> a perif√©rie <code>ios</code>.</p>
</div>
<p>ƒå√≠slo PINu v uk√°zce je 2, to je sv√≠tiv√° dioda vestavƒõn√° v <strong>DoIt</strong> modulech i v na≈°em ESP32boardu. Ale pro pr√°ci s obecn√Ωm modulem, kde m√°me mo≈ænost si nastavit, kde se Led dioda nach√°z√≠, pou≈æijeme pak variantu z√°kladn√≠ uk√°zky z examples, kde <code>BUILT_IN_LED</code> je konstanta, ve kter√© je ƒç√≠slo PINu ulo≈æeno:</p>
<pre><code class="language-python">from components.led import Led
from utils.pinout import set_pinout

pinout = set_pinout()           # set board pinout
led = Led(pinout.BUILT_IN_LED)  # BUILT_IN_LED = 2

print(&quot;---examples/blink.py---&quot;)
# start main loop

while True:
    led.blink()
</code></pre>
<p>ü°í <a href="#pinout">pinout</a></p>
<hr />
<h3 id="rgb"><img alt="hwsoc" src="../img/hwsoc.png" style="width:28px" /> Rgb</h3>
<p>Knihovna pro <em>plnobarevn√©</em> <strong>RGB led</strong> je vytvo≈ôena p≈ôedev≈°√≠m pro pr√°ci s adresovatel√Ωm modulem typu <strong>WS2812b</strong> (<em>proto se pou≈æ√≠v√° zkratka WS</em>). Na≈°e verze je roz≈°√≠≈ôen√≠m vestavƒõn√© t≈ô√≠dy <code>NeoPixel</code>. <em>Pro ≈ô√≠zen√≠ klasick√Ωch R-G-B diod je pot≈ôeba na ka≈ædou barevnou slo≈æku samostatn√Ω PIN, co≈æ vyu≈æ√≠v√°me jen ojedinƒõle, jeliko≈æ voln√Ωch PIN≈Ø na ESP u≈æ moc nezb√Ωv√°.</em></p>
<p>Zdrojov√Ω k√≥d knihovny <code>Rgb</code> ü°í <a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/components/rgb/__init__.py">components/rgb</a> (<em>slou≈æ√≠ i jako uk√°zka, jak lze t≈ô√≠du roz≈°√≠≈ôit</em>)</p>
<p>T≈ô√≠da je roz≈°√≠≈ôena o nƒõkter√© nov√© metody:</p>
<ul>
<li><code>color(color)</code> # pro jednu LED diodu, color ve form√°tu (R,G,B), 0-255</li>
<li><code>color(color, index)</code> # pro v√≠ce modul≈Ø, indexov√°no</li>
<li><code>simpleTest()</code> # probƒõhne R, G, B</li>
<li><code>wheel()</code> # z ƒç√≠sla vygeneruje barvu</li>
<li><code>random_color()</code> # n√°hodn√° barva</li>
<li><code>rainbow_cycle()</code> # duha</li>
</ul>
<pre><code class="language-python">from components.rgb import Rgb
ws = Rgb(15) # BUILT_IN_RGB (WS) ROBOTboard
ws.color((255,0,0)) # R G B =&gt; RED

ws.simpleTest()

import colors_rgb as rgb # definice barev v /lib - BLACK (nesv√≠t√≠)
ws.color(rgb.BLUE)       # zobrazen√≠ barvy, rgb.RED/rgb.GREEN ...


</code></pre>
<div class="admonition note">
<p class="admonition-title"><strong>note</strong></p>
<p>Pro obecnƒõj≈°√≠ pr√°ci s vyu≈æit√≠m <code>set_pinout()</code> (p≈ôeddefinovan√Ωch <a href="/#pinout">pin≈Ø</a>) a <code>io_config</code> p≈ôedpokl√°d√°me, ≈æe pro <a href="/framework">Octopus FrameWork</a> m√°te pomoc√≠ <a href="/setup">setup()</a> nastavenu desku <code>ds</code> a perif√©rie <code>ios</code>.</p>
</div>
<p>N√°sleduj√≠c√≠ uk√°zka naznaƒçuje komplexnƒõj≈°√≠ pr√°ci s p≈ôedkonfigurovan√Ωmi konstantamy, kter√© urƒçuj√≠ na kter√©m pinu (<code>pinout.WS_LED_PIN</code>) a kolik modul≈Ø m√°me (<code>io_conf.get('ws')</code>).</p>
<pre><code class="language-python">from components.rgb import Rgb

from utils.pinout import set_pinout
pinout = set_pinout()   # set board pinout

from utils.io_config import get_from_file
io_conf = get_from_file()

ws = Rgb(pinout.WS_LED_PIN,io_conf.get('ws'))

print(&quot;---examples/rgb_blink.py---&quot;)
ws.simpleTest()
</code></pre>
<p>Zdrojov√Ω k√≥d uk√°zky: <a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/examples/rgb_blink.py">examples/rgb_blink.py</a></p>
<p>Pro bƒõ≈ænou pr√°ci je v prvn√≠ f√°zi snadnƒõj≈°√≠ pou≈æ√≠t p≈ôedchoz√≠ variantu, ale pro rozs√°hlej≈°√≠ projekty a pr√°ci v t√Ωmu se mus√≠ zdokumentovat pou≈æit√≠ "magick√© konstanty" <strong>15</strong> v definici <code>ws = Rgb(15)</code>.</p>
<p>ü°í <a href="#pinout">pinout</a></p>
<hr />
<h3 id="analog"><img alt="hwsoc" src="../img/hwsoc.png" style="width:28px" /> Analog</h3>
<p>Tento modul je pro pr√°ci s analogov√Ωm vstupem pomoc√≠ DAC p≈ôevodn√≠ku. Opƒõt se jedn√° o roz≈°√≠≈ôen√≠ z√°kladn√≠ t≈ô√≠dy <code>ADC</code>, kde vytvo≈ôen√≠m instance s parametrem vstupn√≠ho PINu zjednodu≈°ujeme celou inicializaci na <code>an = Analog(33)</code>. Z√°kladn√≠ metodu <code>read()</code> jsme roz≈°√≠≈ôili o <code>get_adc_aver(num)</code>, kde poƒç√≠t√°me pr≈Ømƒõr z <em>num</em> nemƒõ≈ôen√Ωch hodnot.</p>
<p>Zdrojov√Ω k√≥d knihovny: <a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/components/analog/__init__.py">components/analog</a></p>
<pre><code class="language-python">from time import sleep
from components.analog import Analog

an2 = Analog(33)

while True:
    data =  an2.get_adc_aver(8)
    print(data)
    sleep(5)
</code></pre>
<hr />
<h3 id="button"><img alt="hwsoc" src="../img/hwsoc.png" style="width:28px" /> Button</h3>
<p>Pro z√°kladn√≠ pr√°ci s tlaƒç√≠tky. P≈Øvodnƒõ jsme pou≈æ√≠vali samostatn√Ω blok s p≈ôeru≈°en√≠m, ale knihovna pak byla p≈ôeps√°na tak, ≈æe vyu≈æ√≠v√° dekor√°tor <code>@led_button.on_press</code>, kter√Ωm uvedeme (odekorujeme) vlastn√≠ funkci <code>on_press_top_button()</code>, kter√° se vyvol√° v≈ædy, kdy≈æ se zm√°ƒçkne tlaƒç√≠tko. Cel√° funkce pak bƒõ≈æ√≠ na pozad√≠, je neblokuj√≠c√≠, a snadno i spolehlivƒõ se d√° pou≈æ√≠t i pro v√≠ce tlaƒç√≠tek.</p>
<p>Zdrojov√Ω k√≥d knihovny: <a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/components/button/__init__.py">components/button</a></p>
<pre><code class="language-python">from machine import Pin
from components.button import Button

boot_pin = Pin(0, Pin.IN)
boot_button = Button(boot_pin, release_value=1)


@boot_button.on_press
def boot_button_on_press():
    print('boot_button_on_press')


@boot_button.on_long_press
def boot_button_on_long_press():
    print('boot_button_on_long_press')


@boot_button.on_release
def boot_button_on_release():
    print('boot_button_on_release')

</code></pre>
<p>Star√° verze 1.0 mƒõla v konstruktoru ƒç√≠slo PINu.
Nov√° verze 2.0 m√° p≈ô√≠mo instanci PINu.</p>
<pre><code class="language-python">from time import sleep
from machine import Pin
from components.button import Button

led_button = Button(0, release_value=1)
built_in_led = Pin(2, Pin.OUT)

built_in_led.on()
sleep(1)
built_in_led.off()

@led_button.on_press
def on_press_top_button():
    print(&quot;on_press_top_button&quot;)
    built_in_led.on()
    sleep(3)
    built_in_led.off()
</code></pre>
<p>ü°í <a href="#led">Led</a> | <a href="#dekorator">@Dekor√°tor</a></p>
<p>Pr√°ce se ƒçty≈ômi tlaƒç√≠tky (na ESP32board) - v uk√°zce je zakomentov√°na spolupr√°ce s displejem <code>tft</code> ü°í <a href="#st7735">st7735</a></p>
<pre><code class="language-python">from utils.pinout import set_pinout
pinout = set_pinout()

from components.button import Button
from utils.transform import Point2D

print(&quot;buttons init&gt;&quot;)
button_dwn = Button(34, release_value=1)
button_top = Button(36, release_value=1)
button_lef = Button(35, release_value=1)
button_rig = Button(39, release_value=1)

# size = 3
cursor = Point2D(63,81) # center TFT128*166 dispaly (mod 3)

def position(dx,dy):
    global mx # cursor, fb, tft
    cursor.x = cursor.x + dx*3
    cursor.y = cursor.y + dy*3

    print(cursor.x,cursor.y)
    # fb.fill(color565(*BLACK))
    # tft.blit_buffer(fb, 0, 0, tft.width, tft.height)
    # tft.fill_rectangle(cursor.x,cursor.y, 6, 6, color565(*RED))


@button_dwn.on_press
def on_press_dwn():
    print(&quot;down&quot;)
    position(0,1)

@button_top.on_press
def on_press_top():
    print(&quot;top&quot;)
    position(0,-1)

@button_lef.on_press
def on_press_lef():
    print(&quot;left&quot;)
    position(-1,0)

@button_rig.on_press
def on_press_rig():
    print(&quot;right&quot;)
    position(1,0)

</code></pre>
<hr />
<h3 id="display7"><img alt="hwsoc" src="../img/hwsoc.png" style="width:28px" /> Display7</h3>
<p>Osm sedmisegmentovek s obvodem MAX na sbƒõrnici <code>SPI</code> je do zaƒç√°tku ide√°ln√≠ displej pro z√°klady pr√°ce s mikrokontrol√©rem. M√° "retro" sedm segment≈Ø pro zobrazen√≠ ƒç√≠sel - proto <code>disp7</code>. Obdobn√Ω modul se shodn√Ωm ovladaƒçem je matice 8x8 sv√≠tiv√Ωch diod, ten jsme pojmenovali <code>disp8</code>.</p>
<p>Zdrojov√Ω k√≥d <a href="https://github.com/octopusengine/octopuslab/tree/master/esp32-micropython/components/display7">components/display7</a></p>
<p>P≈ôed inicializac√≠ se mus√≠ nejd≈ô√≠ve p≈ôipojit <code>SPI</code>. V n√°sleduj√≠c√≠ uk√°zce je "dvojitƒõ" zakomentovan√° <code>##</code> obecnƒõj≈°√≠ metoda a pou≈æit√° je <code>spi_init()</code> z knihovny <code>octopus_lib</code>.</p>
<pre><code class="language-python">from machine import Pin, SPI
from components.display7 import Display7
## from utils.pinout import set_pinout
from utils.octopus_lib import spi_init

print(&quot;this is simple Micropython example | octopusLAB &amp; ESP32&quot;)

print(&quot;--- spi-init ---&quot;)
## pinout = set_pinout()
## spi = SPI(1, baudrate=10000000, polarity=1, phase=0, sck=Pin(pinout.SPI_CLK_PIN), mosi=Pin(pinout.SPI_MOSI_PIN))
spi = spi_init()

ss = Pin(pinout.SPI_CS0_PIN, Pin.OUT)
#spi.deinit() #print(&quot;spi &gt; close&quot;)

print(&quot;--- display7-init ---&quot;)
d7 = Display7(spi, ss) # 8 x 7segment display init
d7.write_to_buffer('octopus')
d7.display()

</code></pre>
<p>Nejkrat≈°√≠ variantou je <strong>octopus framework</strong> verze, kde je ale nutno m√≠t p≈ôes <code>setup()</code> a <code>ds</code> nastavenu desku (nƒõjƒçastƒõji ROBOTboard nebo ESP32board) a d√°le pomoc√≠ <code>ios</code> nastaveno <code>disp7</code> (4 | 1)</p>
<pre><code class="language-python">from time import sleep
from utils.octopus import disp7_init

print(&quot;this is simple Micropython example | ESP32 &amp; octopusLAB&quot;)
print()

d7 = disp7_init()   # 8 x 7segment display init

for i in range(999):
    d7.show(1000-i)
    sleep(1)
</code></pre>
<hr />
<h3 id="oled"><img alt="hwsoc" src="../img/hwsoc.png" style="width:28px" /> Oled</h3>
<p>Obl√≠bili jsme si tak√© mal√Ω 128x64px monochromatick√Ω OLED displej. Jeho p≈ô√≠m√© pou≈æ√≠t√≠ vy≈æaduje u≈æ i inicializaci I2C a dal≈°√≠ drobnosti, proto jsme vƒõt≈°inou vyu≈æ√≠vali knihovny octopus.
Ale uk√°zalo se, ≈æe pro vlastn√≠ projekty je lep≈°√≠ umƒõt spou≈°tƒõt displej i "samostatnƒõ", co≈æ je v uk√°zce:
<a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/examples/test_oled.py">examples/test_oled.py</a></p>
<p>Zjednodu≈°en√© ovl√°d√°n√≠ je pak tradiƒçnƒõ:</p>
<pre><code class="language-python">from utils.octopus import oled_init
oled = oled_init()
...
</code></pre>
<p>Z√°klad ale vych√°z√≠ z knihovny <code>ssd1306</code>, kter√° je u≈æ souƒç√°st√≠ Micropythonu:</p>
<pre><code class="language-python">def oled_init():

    from utils.pinout import set_pinout
    from machine import Pin, I2C
    import ssd1306

    # pinout = set_pinout()
    # i2c = I2C(0, scl=Pin(pinout.I2C_SCL_PIN), sda=Pin(pinout.I2C_SDA_PIN), freq=100000)
    from utils.octopus_lib import i2c_init
    i2c = i2c_init()

    oled = ssd1306.SSD1306_I2C(128, 64, i2c, 0x3c)
    return oled

oled = oled_init()
oled.text(&quot;octopusLAB&quot;, 0, 0)
oled.show()

oled.draw_image() # default /assets/octopus_image.pbm
oled.invert(0)
...
</code></pre>
<pre><code class="language-python">&gt;&gt;&gt; from assets.icons9x9 import ICON_clr, ICON_heart
&gt;&gt;&gt; oled.draw_icon(ICON_heart,115,15) 

&gt;&gt;&gt; def heartBeat()               
...    oled.draw_icon(ICON_heart,115,15)
...    sleep(1)
...    oled.draw_icon(ICON_clr,115,15)
...    sleep(1)
...
</code></pre>
<hr />
<h3 id="buzzer"><img alt="hwsoc" src="../img/hwsoc.png" style="width:28px" /> Buzzer</h3>
<p>Pasivn√≠ piezo "p√≠p√°k" slou≈æ√≠ pro akustick√° upozornƒõn√≠, ale um√≠ p≈ôehr√°t i velmi jednoduch√© "retro" melodie.</p>
<p>Zdrojov√Ω k√≥d knihovny: <a href="https://github.com/octopusengine/octopuslab/tree/master/esp32-micropython/components/buzzer">components/buzzer</a></p>
<p>Z√°klad pr√°ce:</p>
<pre><code class="language-python">from components.buzzer import Buzzer
piezzo = Buzzer(33)
piezzo.beep()
</code></pre>
<p>Dopl≈àuj√≠c√≠ t≈ô√≠da <code>melody</code> jako p≈ôid√°n√≠ dal≈°√≠ ƒç√°sti k√≥du:</p>
<pre><code class="language-python">from components.buzzer.melody import jingle1
piezzo.play_melody(jingle1)
</code></pre>
<hr />
<h3 id="servo"><img alt="hwsoc" src="../img/mchtr.png" style="width:28px" /> Servo</h3>
<p>Modul pro pr√°ci se servem, opƒõt vytvo≈ôen√≠m instance na dan√©m PINu (mus√≠ b√Ωt PWM).
Hlavn√≠ metodou je pak pootoƒçen√≠ na dan√Ω √∫hel:  <code>set_degree()</code>.</p>
<p>Zdrojov√Ω k√≥d knihovny: <a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/components/servo/__init__.py">components/servo</a></p>
<pre><code class="language-python">from time import sleep
from utils.pinout import set_pinout

from components.servo import Servo
pinout = set_pinout()

# s1 = Servo(pinout.PWM1_PIN)
# s2 = Servo(pinout.PWM2_PIN)
s3 = Servo(pinout.PWM3_PIN)

angles = [0, 20, 50, 70, 90]

while True:
    for a in angles:
        s3.set_degree(a)
        sleep(1)
</code></pre>
<h4 id="pca9685">pca9685</h4>
<p>Element√°rn√≠ z√°klad pr√°ce s v√≠ce servy pomoc√≠ I2C expand√©ru pca9685: </p>
<pre><code class="language-python">from pca9685.servo import Servos
from utils.octopus_lib import i2c_init
from time import sleep_ms
from utils.transform import * # include all - only for example


# blocking - simple test
def sweep(s, start, stop, delay=5, step=1):
   ang = start
   servo.position(s, ang)
   sleep_ms(delay)

   if start &lt; stop:
      print(&quot;a&quot;)
      while ang &lt; stop:
         ang = ang + step
         servo.position(s, ang)
         sleep_ms(delay)

   if start &gt; stop:
      print(&quot;b&quot;)
      while ang &gt; stop:
         ang = ang - step
         servo.position(s, ang)
         sleep_ms(delay)


i2c = i2c_init(1)
servo = Servos(i2c)


def sweeptest():
    sweep(0,30,160)
    sweep(1,30,180)
    sweep(0,160,30)
    sweep(1,180,30)

sweeptest()
</code></pre>
<p>Zdrojov√Ω k√≥d uk√°zky:
<a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/examples/pca9685.py">https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/examples/pca9685.py</a></p>
<p>Pro tranformace a kompletnƒõj≈°√≠ pr√°ci s v√≠ce servy vyv√≠j√≠me knihovnu <code>transform</code>:
<a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/utils/transform.py">https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/utils/transform.py</a></p>
<p>ü°í <a href="#pinout">pinout</a></p>
<hr />
<h3 id="dcmotors"><img alt="hwsoc" src="../img/mchtr.png" style="width:28px" /> DCmotors</h3>
<p>Zdrojov√Ω k√≥d knihovny: <a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/components/dcmotors/__init__.py">components/dcmotors</a></p>
<pre><code class="language-python">from utils.pinout import set_pinout
pinout = set_pinout()

from components.dcmotors import Motor, Steering

motor_r = Motor(pinout.MOTOR_1A, pinout.MOTOR_2A, pinout.MOTOR_12EN)
motor_l = Motor(pinout.MOTOR_3A, pinout.MOTOR_4A, pinout.MOTOR_34EN)
steering = Steering(motor_l, motor_r)
speed = 800

steering.center(0)
steering.center(-speed)
steering.right(speed)
steering.left(speed)
</code></pre>
<hr />
<h3 id="iot"><img alt="hwsoc" src="../img/wsetup.png" style="width:28px" /> IoT</h3>
<p>T≈ô√≠da, kter√° p≈Øvodnƒõ slou≈æila jako modul pro IoTboard, ale samostatn√° zahrnuje rel√© a PWM MOS-FET ≈ô√≠zen√≠.</p>
<p>Zdrojov√Ω k√≥d knihovny: <a href="https://github.com/octopusengine/octopuslab/tree/master/esp32-micropython/components/iot">components/iot</a></p>
<p>Uk√°zka: </p>
<pre><code class="language-python">from components.iot import Relay
re1 = Relay() # default IoTboard pin 
re1.value(1)
re2 = Relay(26)


from components.iot import Pwm
pwm_led = Pwm(33)
pwm_led.duty(300)


from components.iot import Thermometer
tt = Thermometer(32)  # DEV1 pin (ROBOTboard)
tx = tt.ds.scan()  # get list of all Dallas sensors
tt.get_temp()  # default index 0 -&gt; first sensor
tt.get_temp(0)  # first sensor explicitly
</code></pre>
<hr />
<h2 id="octopus-utils">OCTOPUS Utils</h2>
<h3 id="wificonnect"><img alt="hwsoc" src="../img/bits.png" style="width:28px" /> WiFiConnect</h3>
<p>Hlavn√≠ v√Ωhodou na≈°eho roz≈°√≠≈ôen√≠ pro p≈ôipojen√≠ k WiFi je pou≈æ√≠v√°n√≠ ulo≈æen√©ho nastaven√≠ (v <code>config/wifi.json</code>).
Nastaven√≠ WiFi se prov√°d√≠ pomoc√≠ <a href="../install/#setup-nastaveni-systemu">setup()</a></p>
<pre><code class="language-python">from utils.wifi_connect import WiFiConnect

net = WiFiConnect()
net.connect()
</code></pre>
<pre><code class="language-python">if not net.isconnected()
    # hard reconect
    net.sta_if.disconnect()
    net.connect()
</code></pre>
<p>V p≈ô√≠padƒõ "z√°va≈ænƒõj≈°√≠ho probl√©mu" s p≈ôipojen√≠m nƒõkdy pom≈Ø≈æe a≈æ "tvrd√Ω" <a href="#reset">reset</a>.</p>
<pre><code class="language-python"># hard reset
reset()
</code></pre>
<p>Vyu≈æit√≠ <a href="/framework">Octopus FrameWork</a> na maximum - k p≈ôipojen√≠ k nƒõkter√© z ulo≈æen√Ωch WiFi postaƒç√≠ p≈ô√≠kaz <code>w()</code>:</p>
<pre><code class="language-python">from utils.octopus_lib import w
w()
</code></pre>
<p>Variantnƒõ s dostupn√Ωmi metodami:</p>
<pre><code class="language-python">wc = w()
ip = wc.sta_if.ifconfig()[0]
...
wc.isconnected()
</code></pre>
<p>A opaƒçn√Ω extr√©m - klasick√© p≈ôipojen√≠ k s√≠ti s p≈ôed√°n√≠m parametr≈Ø <code>ssid</code> (n√°zev) a <code>password</code> (heslo):</p>
<pre><code class="language-python">import network
wlan = network.WLAN(network.STA_IF)
wlan.active(True)
wlan.connect('ssid', 'password')
</code></pre>
<p>Umo≈æn√≠ n√°m (od verze v1.16 on 2021-08-09) skenovat celu s√≠≈•:</p>
<pre><code class="language-python">llan = wlan.scan() # list
for i in llan:
    print(i[0],i[2])
</code></pre>
<p>Origin√°ln√≠ dokumentace <a href="https://docs.micropython.org/en/latest/library/network.WLAN.html">wlan()</a></p>
<hr />
<h3 id="bits"><img alt="hwsoc" src="../img/bits.png" style="width:28px" /> Bits</h3>
<p>Pro pr√°ci s jednotliv√Ωmi <strong>bity</strong>. <code>B1 = 0b11111001</code>. Bitov√© operace jsme si museli do Pythonu trochu doladit, aby se s nimi pracovalo l√©pe a intuitivnƒõ. <strong>Pou≈æ√≠van√© metody:</strong></p>
<ul>
<li><code>neg(B1)</code> pro negaci - vrac√≠ <em>0b00000110</em></li>
<li><code>reverse()</code> obr√°cen√≠ po≈ôad√≠ bit≈Ø - vrac√≠ <em>0b1001111</em></li>
<li><code>get_bit(B1,1)</code> pro z√≠sk√°n√≠ stavu jednoho bitu &gt; 0</li>
<li><code>set_bit(B1,1)</code> pro nastaven√≠ stavu jednoho bitu</li>
<li><code>int2bin()</code> pomocn√° funkce pro p≈ôevod ƒç√≠sla na bin√°rn√≠</li>
</ul>
<p>Zdrojov√Ω k√≥d knihovny: <a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/utils/bits/__init__.py">utils/bits</a></p>
<pre><code class="language-python">from components.bits import neg
B1 = 0b11111001
neg(B1) # &gt; 0b00000110

</code></pre>
<hr />
<h3 id="transform"><img alt="hwsoc" src="../img/mchtr.png" style="width:28px" /> Transform</h3>
<p>Pomocn√© funkce pro mechatroniku, zamƒõ≈ôen√© na transformace sou≈ôadnicov√Ωch syst√©m≈Ø a z√°klady inversn√≠ kinematiky.</p>
<ul>
<li><code>Point2D()</code> class p2 = (x,y) | p2.x, p2.y</li>
<li><code>distance2D(p1, p2, rr = 3)</code> vzd√°lenost dvou bod≈Ø v rovinƒõ</li>
<li><em>vyu≈æ√≠v√° se round - zaokrouhlen√≠ na urƒçit√Ω poƒçet m√≠st:</em> <code>rr</code> = 3 </li>
<li><code>polar2cart(r, alfa, rr = 3)</code></li>
<li><code>cart2polar(point)</code></li>
<li><code>def cosangle(opp, adj1, adj2)</code></li>
<li><code>move_2d_line(p_start, p_stop, steps = 300, max_dist = 100)</code></li>
<li><code>invkin2_1(point2d, rr = 6)</code> inversn√≠ kinematika 1</li>
<li><code>invkin2(point2d, angleMode=DEGREES)</code></li>
<li><code>Point3D()</code> class p3 = [x,y,z]</li>
<li><code>invkin3(point3d, angleMode=DEGREES)</code></li>
<li><code>distance3()</code> vzd√°lenost dvou bod≈Ø v prostoru</li>
<li>...</li>
</ul>
<pre><code class="language-python">from utils.transform import Point2D, polar2cart, cosangle
p1 = Point2D(1,3)
print(p1)   # (1,3)
print(p1.x) # 1
print(p1.y) # 3
p1.x, p1.y = polar2cart(10, 0)
print(p1)
...
</code></pre>
<pre><code class="language-python">from utils.transform import move_servo2, cosangle

...
def move_servo2(p1, p2, delay = delay):
    steps = move_2d_line(p1, p2)
    for step in steps:
        alfa = cosangle(step[0], dist, dist)[0]
        beta = cosangle(step[1], dist, dist)[0]
        print(step, alfa, beta)

        s1.set_degree(alfa)
        s2.set_degree(beta)
        sleep_ms(delay)

p1 = 0, 0 # strart point
p2 = 50, 50 # stop point
move_servo2(p1, p2)

</code></pre>
<p>V√≠ce pl√°nujeme v samostatn√© sekci <a href="/inv_kinematics">inversn√≠ kinematika</a></p>
<hr />
<h3 id="database"><img alt="hwsoc" src="../img/database.png" style="width:28px" /> Database</h3>
<p>ESP d√≠ky pamƒõti umo≈æ≈àuje bez nads√°zky i z√°kladn√≠ pr√°ci s datab√°z√≠.
Zamƒõ≈ô√≠me se na dvƒõ z√°kladn√≠: lok√°ln√≠ <code>btree</code> a vzd√°len√© <code>MySQL</code>, <code>InfluxDB</code>.</p>
<pre><code class="language-python">from utils.database.btreedb import BTreeDB
db = BTreeDB(&quot;test&quot;)
db.addOne(&quot;one&quot;,&quot;1&quot;)
db.listAll()
</code></pre>
<p>Zv√≠davƒõj≈°√≠m doporuƒçujeme odkaz na pr√°ci s daty a datab√°ze ü°í <a href="/ws-python-data">Workshop Python DATA</a></p>
<hr />
<h3 id="mqtt"><img alt="hwsoc" src="../img/database.png" style="width:28px" /> MQTT</h3>
<ul>
<li>MQTT - jako pub-sub</li>
<li>MQTT broker - na RPi</li>
<li>orchestr√°tor NodeJS</li>
<li>vyu≈æit√≠ v IoT</li>
</ul>
<hr />
<h3 id="influxdb"><img alt="hwsoc" src="../img/database.png" style="width:28px" /> InfluxDB</h3>
<p>Pro zobrazov√°n√≠ dat v <strong>Grafanƒõ</strong> pr≈Øbƒõ≈ænƒõ pos√≠l√°me √∫daje na vzd√°len√Ω server, kter√Ω je ukl√°d√° do datab√°ze <strong>InfluxDB</strong>.
Jednoduch√Ω p≈ô√≠klad jednor√°zov√©ho odesl√°n√≠ jedn√© hodnoty (<strong>timestamp</strong> - datum a ƒças se p≈ôidaj√≠ p≈ôi ukl√°d√°n√≠ automaticky):</p>
<pre><code class="language-python">from utils.database.influxdb import InfluxDB

influx = InfluxDB(&quot;https://your.server.com/grafana/influx/user...&quot;, &quot;user_db&quot;, &quot;i_usr&quot;, &quot;i_psw&quot;, &quot;i_measurement&quot;)

value = 25.6  # zde je treba cist hodnotu z nejakeho senzoru, napr. teplomeru
influx.write(temperature=value)
...
</code></pre>
<p>Metoda <code>write</code> mus√≠ dostat pojmenovan√© parametry (key word arguments - tzv. kwargs), kter√© se v Influxu pou≈æij√≠, jako jednotliv√© fieldy. V p≈ô√≠kladu naho≈ôe je to <code>temperature</code>, kam ukl√°d√°me hodnotu ze sensoru.</p>
<p>Funkƒçn√≠ uk√°zka nap≈ô: <a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/examples/influxdb_disp7_therm.py">examples/influxdb_disp7_therm.py</a></p>
<hr />
<p>Abychom mohli pou≈æ√≠t identick√Ω program s minimem zmƒõn,
vyu≈æijeme konfiguraƒçn√≠ soubor, naƒçteme pomoc√≠ <code>fromconfig()</code>. A tak√© nechceme m√≠t <strong>p≈ô√≠stupov√© √∫daje ve zdrojov√©m k√≥du</strong>! </p>
<pre><code class="language-python">from utils.database.influxdb import InfluxDB

influx = InfluxDB.fromconfig()

temp = ...
influx.write(temperature=temp)
</code></pre>
<p><code>fromconfig()</code> bere volitelnƒõ jako prvn√≠ parametr, n√°zev konfiguraƒçn√≠ho souboru, default je <code>"influxdb"</code>, tedy soubor <code>config/influxdb.json</code>.</p>
<p>P≈ô√≠klad obsahu je:</p>
<pre><code class="language-json">{&quot;influxdb_url&quot;: &quot;https://parallelgarden.surikata.info:8086&quot;, &quot;influxdb_pass&quot;: &quot;heslo&quot;, &quot;influxdb_name&quot;: &quot;nazev_db&quot;, &quot;influxdb_user&quot;: &quot;uzivatel&quot;, &quot;influxdb_measurement&quot;: &quot;meteo&quot;, &quot;influxdb_tags&quot;: {&quot;location&quot;: &quot;balkon&quot;}}
</code></pre>
<p>V√≠ce o vytv√°≈ôen√≠ a editaci konfiguraƒçn√≠ch soubor≈Ø ü°í <a href="#config">Config</a></p>
<hr />
<h2 id="octopus-lib">OCTOPUS Lib</h2>
<h3 id="lcd">LCD</h3>
<p>Knihovna t≈ôet√≠ strany pro ovl√°d√°n√≠ dvou nebo ƒçty≈ô-≈ô√°dkov√©ho LCD displeje p≈ôipojen√©ho k <code>i2c</code> expand√©ru, byla p≈Øvodnƒõ urƒçena pro star≈°√≠ ESP8266, ale funguje n√°m bez √∫prav i pro ESP32 (proto≈æe komunikaƒçn√≠ protokol na i2c se nemƒõn√≠).</p>
<p>Z√°kladem v nastaven√≠ je: poƒçet ≈ô√°dk≈Ø <code>rows</code> - &frac12;/4, a poƒçet "sloupc≈Ø" <code>col</code> odpov√≠d√° poƒçtu znak≈Ø na ≈ô√°dku.
Uk√°zka pro displej <code>2x16</code> - s hlavn√≠ metodou <code>putstr(STRING)</code>.</p>
<pre><code class="language-python"># from machine import I2C , Pin
# i = I2C(scl=Pin(22), sda=Pin(21), freq=100000)
from utils.octopus_lib import i2c_init
i2c = i2c_init()
# i2c.scan() # &gt; [39]
from lib.esp8266_i2c_lcd import I2cLcd
lcd = I2cLcd(i2c, 39, 2, 16) # addr, rows, col
lcd.putstr(&quot;octopusLab&quot;) # write text
...
</code></pre>
<p>Pomoc√≠ speci√°ln√≠ch znak≈Ø (u≈æ implementovan√Ωch) lze vykreslit nap≈ô√≠klad stupnƒõ Celsia (pro zobrazov√°n√≠ teploty):</p>
<pre><code class="language-python">lcd.putstr(chr(223))
</code></pre>
<p>Nastaven√≠ kurzoru <code>move_to()</code> a uk√°zka zobrazen√≠ hodin s blikaj√≠c√≠ dvojteƒçku:</p>
<pre><code class="language-python">def clock():
    lcd.move_to(5,1)
    lcd.putstr(get_hhmm(&quot;:&quot;))
    sleep(0.5)
    lcd.move_to(5,1)
    lcd.putstr(get_hhmm(&quot; &quot;))
    sleep(1)
</code></pre>
<p>V na≈°em podadres√°≈ôi <code>/assets</code> m√°me v souboru <code>lcd_chars.py</code> tabulky nƒõkter√Ωch "novƒõ definovan√Ωch" znak≈Ø pro LCD:</p>
<pre><code class="language-python">import assets.lcd_chars as ch

from utils.octopus import lcd2_init
lcd = lcd2_init()

lcd.custom_char(0, ch.happy)
lcd.putchar(chr(0))

lcd.custom_char(1, ch.clock)
lcd.putchar(chr(1))

...
</code></pre>
<hr />
<h3 id="st7735">ST7735</h3>
<p>Barevn√Ω displej TFT 128x160, kter√Ω ale vy≈æaduje p≈ôi pr√°ci s Micropythonem vƒõt≈°√≠ pamƒõ≈•.</p>
<p>Doporuƒçen√© p≈ôipojen√≠ k <code>ESP32board</code>:</p>
<pre><code>Display | ESP32board
------------------------
1-RST   | PWM2 (16)
2-CS    | SCE0 (5)
3-D/C   | PWM1 (17)
4-DIN   | SPI_MOSI (23)
5-CLK   | SPI_CLK (18)
6-UCC   | 5V
7-BL    | 3V3
8-GND   | GND
</code></pre>
<p><strong>Nov√° verze</strong></p>
<pre><code class="language-python">from ST7735 import TFT, TFTColor
from sysfont import sysfont
from machine import SPI, Pin
from time import sleep_ms, ticks_ms
from math import pi
from utils.octopus_lib import w # need connection for FTP

SPI_SCLK = 18
SPI_MISO = 19
SPI_MOSI = 23

DC = 17   # PWM1
RST = 16  # PWM2
CS = 5    # SCE0

print(&quot;--- TFT 128x160px test ---&quot;)

spi = SPI(2, baudrate=20000000, polarity=0, phase=0, sck=Pin(SPI_SCLK), mosi=Pin(SPI_MOSI), miso=Pin(SPI_MISO))
tft=TFT(spi, DC, RST, CS)
tft.initr()
tft.rgb(True)

tft.fill(TFT.BLACK)
v = 30
tft.text((0, v), &quot;octopus LAB (1)&quot;, TFT.RED, sysfont, 1, nowrap=True)
v += sysfont[&quot;Height&quot;]

tft.fill(TFT.BLACK)
tft.rotation(1)
tft.text((0, 0), &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur adipiscing ante sed nibh tincidunt feugiat. Maecenas enim massa, fringilla sed malesuada et, malesuada sit amet turpis. Sed porttitor neque ut ante pretium vitae malesuada nunc bibendum. &quot;, TFT.WHITE, sysfont, 1)
sleep_ms(2000)

...

</code></pre>
<p><strong>P≈Øvodn√≠ star≈°√≠ verze</strong></p>
<pre><code class="language-python">from machine import Pin, SPI, SDCard
from time import sleep, sleep_ms

from utils.pinout import set_pinout
pinout = set_pinout()

import framebuf
from lib import st7735
from lib.rgb import color565

print(&quot;spi.TFT 128x160 init &gt;&quot;)
spi = SPI(1, baudrate=10000000, polarity=1, phase=0, sck=Pin(pinout.SPI_CLK_PIN), mosi=Pin(pinout.SPI_MOSI_PIN))
ss = Pin(pinout.SPI_CS0_PIN, Pin.OUT)

rst = Pin(16, Pin.OUT) #PWM2 (16) / DEv3(27)
cs = Pin(5, Pin.OUT)   #SCE0 (5)
dc = Pin(26, Pin.OUT)  #PWM1 (17) /  IO26

tft = st7735.ST7735R(spi, cs = cs, dc = dc, rst = rst)

print(&quot;spi.TFT framebufer &gt;&quot;)
fb = framebuf.FrameBuffer(bytearray(tft.width*tft.height*2), tft.width, tft.height, framebuf.RGB565)
fbp = fb.pixel

fb.line(128,0,0,166,color565(0,255,0))
tft.blit_buffer(fb, 0, 0, tft.width, tft.height)
...
</code></pre>
<p>ü°í <a href="#pinout">pinout</a></p>
<p><a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/examples/test_tft128x160.py">examples/test_tft128x160.py</a></p>
<hr />
<h3 id="hcsr04">hcsr04</h3>
<p>Ultrazvukov√Ω mƒõ≈ôiƒç vzd√°lenosti.</p>
<pre><code class="language-python">from time import sleep
from util.pinout import set_pinout

pinout = set_pinout()

from hcsr04 import HCSR04
print(&quot;ulrasonic distance sensor&quot;)
echo = HCSR04(trigger_pin=pinout.PWM2_PIN, echo_pin=pinout.PWM1_PIN)

while True:
    echo_cm = echo.distance_cm()
    print(echo_cm)
    sleep(1)

</code></pre>
<p>ü°í <a href="#pinout">pinout</a></p>
<p><a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/examples/ultrasonic.py">examples/ultrasonic.py</a></p>
<hr />
<h3 id="pubsub"><img alt="hwsoc" src="../img/database.png" style="width:28px" /> pubsub</h3>
<p>N√°stroj pro p≈ôed√°v√°n√≠ hodnot mezi nez√°visl√Ωmi komponenty v r√°mci projektu a to i v samostatnƒõ bƒõ≈æ√≠c√≠ch vl√°knech. Pracuje na principu <strong>publish and subscribe</strong>. Fork z <a href="https://github.com/basecue/micropython-pubsub">basecue/micropython-pubsub</a>.</p>
<p>Zdrojov√Ω k√≥d knihovny: <a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/lib/pubsub.py">./lib/pubsub.py</a></p>
<p>Z√°klad pr√°ce: jedno vl√°kno (nebo ƒç√°st programu) publikuje z√≠skan√© hodnoty metodou <code>publish</code> kde parametrem je <code>topic</code> a hodnota <code>value</code>. Nap≈ô√≠klad<code>pubsub.publish('topic', value)</code>. (value m≈Ø≈æe b√Ωt libovoln√Ω objekt). V jednoduch√© uk√°zce  jednou za vte≈ôinu generujeme n√°hodn√° ƒç√≠sla, kter√° "publikujeme". (pozor, pou≈æ√≠v√°me <code>while True:</code> - je to blokuj√≠c√≠, lep≈°√≠ je pou≈æ√≠t <code>timer</code>)</p>
<pre><code class="language-python">from time import sleep
from os import urandom
import pubsub


print(&quot;start: ps_random.py&quot;)

while True:
    value =  int(urandom(1)[0])
    print(&quot;rnd.: &quot;, value)
    pubsub.publish('value', value)
    sleep(1)
</code></pre>
<p>Protistrana je odeb√≠r√° / naslouch√°.
A m≈Ø≈æe je t≈ôeba zobrazovat na displeji:</p>
<pre><code class="language-python">import pubsub
from utils.octopus import disp7_init

d7 = disp7_init()  # 8 x 7segment display init


@pubsub.subscriber(&quot;value&quot;)
def display_num(value):
    d7.show(value)
</code></pre>
<p>ü°í <a href="#disp7">Disp7</a></p>
<p>Uk√°zky jsou z vybran√Ωch p≈ô√≠klad≈Ø pro pubsub: 
<a href="https://github.com/octopusengine/octopuslab/tree/master/esp32-micropython/examples/pubsub">examples/pubsub</a></p>
<hr />
<h3 id="ble"><img alt="hwsoc" src="../img/bt.png" style="width:28px" /> BLE</h3>
<p>Jeliko≈æ obecn√° problematika BLE (Bluetooth low energy) je pomƒõrnƒõ obs√°hl√°, tak i modul BLE je dost robustn√≠. Zahrnuje nƒõkolik ƒç√°st√≠: <code>blesync</code>, <code>blesync_client</code>, <code>blesync_server</code> a samostatn√Ω modul <code>blesync_uart</code>. Ka≈ædop√°dnƒõ funguje velmi dob≈ôe a snahou bylo, aby pr√°ce s n√≠m byla srozumiteln√° a p≈ôitom umo≈ænila vyu≈æ√≠t v≈°echny mo≈æn√© v√Ωhody, kter√© BLE obecnƒõ p≈ôin√°≈°√≠.
Projekt m√° sv≈Øj vlastn√≠ repozit√°≈ô: <a href="https://github.com/blesync">/blesync</a>.</p>
<p>N√°sleduj√≠c√≠ p≈ô√≠klad umo≈æn√≠ z mobiln√≠ aplikace nal√©zt ESP za≈ô√≠zen√≠ jako <code>octopus-led-UID</code>, kde UID je ƒç√°s unik√°tn√≠ho ID, kter√© m√° ka≈æd√© ESP.
Pomoc√≠ mobiln√≠ aplikace ≈°ipkami nahoru (Up) a dol≈Ø (DOWN) pak ovl√°d√°me vestavƒõnou Led diodu.</p>
<pre><code class="language-python">import blesync_server
import blesync_uart.server
import utils.ble.bluefruit as bf

from shell.terminal import getUid
uID5 = getUid(short=5)

from time import sleep
from components.led import Led
led = Led(2)


@blesync_uart.server.UARTService.on_message
def on_message(service, conn_handle, message):
    if message == bf.UP:
        led.value(1)
    if message == bf.DOWN:
        led.value(0)
    if message == bf.RIGHT:
        led.toggle()

    service.send(conn_handle, message)

_connections = []


devName = 'octopus-led-'+uID5
print(&quot;BLE ESP32 device name: &quot; + devName)

server = blesync_server.Server(devName, blesync_uart.server.UARTService)
server.start()

</code></pre>
<h4 id="mobilni-aplikace-pro-ble"><img alt="hwsoc" src="../img/mobplg.png" style="width:28px" /> Mobiln√≠ aplikace pro BLE</h4>
<p>Pou≈æ√≠v√°me <strong>Bluefruit connect</strong> od spoleƒçnosti Adafruit. Jeden z odkaz≈Ø na <a href="https://play.google.com/store/apps/details?id=com.adafruit.bluefruit.le.connect&amp;hl=cs">play.google.com/store/apps</a></p>
<p>Vytvo≈ôili jsme si pomocnou knihovnu pro "p≈ôekl√°d√°n√≠" jimi definovan√Ωch k√≥d≈Ø, kter√° je zat√≠m zde <code>./utils/ble/blefruit.py</code>:</p>
<pre><code class="language-python">UP =   b'!B516'
DOWN = b'!B615'
LEFT = b'!B714'
RIGHT = b'!B813'
...
</code></pre>
<p>S touto knihovnou pak pracujeme takto:</p>
<pre><code class="language-python">import utils.ble.bluefruit as bf
...
    if message == bf.UP:
        led.value(1)
    if message == bf.DOWN:
        led.value(0)
</code></pre>
<hr />
<h2 id="ostatni-podpurne-moduly">Ostatn√≠ podp≈Ørn√© moduly</h2>
<h3 id="config"><img alt="hwsoc" src="../img/database.png" style="width:28px" /> Config</h3>
<p>Micropython m√° elegantnƒõ propacovanou pr√°ci se soubory (nahr√°v√°n√≠ a ƒçten√≠) a i s <code>json</code> form√°tem, proto jsme toho vyu≈æili pro extern√≠ konfiguraƒçn√≠ soubory. V adres√°≈ôi <code>/config</code> jsou nahr√°ny jednotliv√© "jsony", kter√© v sobƒõ obsahuj√≠ nƒõjak√© konstanty, nastaven√≠ a podobnƒõ. Proto m≈Ø≈æeme dan√Ω projekt dynamicky konfigurovat. Vyu≈æ√≠v√°me to i v nastaven√≠ PIN≈Ø jednotiv√Ωch za≈ô√≠zen√≠ <code>device.json</code> nebo pro ulo≈æen√≠ p≈ô√≠stup≈Ø k WiFi <code>wifi.json</code>.</p>
<p>Zdrojov√Ω k√≥d knihovny: <a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/config/__init__.py">./config/<strong>init</strong>.py</a></p>
<h4 id="jednotlive-metody-pro-zakladni-varianty-pouzivani">Jednotliv√© <strong>metody</strong> pro z√°kladn√≠ varianty pou≈æ√≠v√°n√≠:</h4>
<p>1) Vytvo≈ôen√≠m pomoc√≠ konstruktoru: <code>myConfig = Config("myConfigFile",keys)</code>      <br />
Vy≈æaduje p≈ôedefinici kl√≠ƒçov√Ωch "metrik": <code>keys = ["tempMax","tempMin"]</code></p>
<ul>
<li><code>setup()</code></li>
<li><code>print()</code> # for keys</li>
</ul>
<p>Mƒõjme uk√°zkov√Ω projekt <strong>termostat</strong>, kter√Ω na z√°kladƒõ zmƒõ≈ôen√© teploty pust√≠ buƒè topen√≠, nebo chlazen√≠ (ventil√°tor). Volitelnƒõ si m≈Ø≈æeme v programu definovat <code>keys</code>, kde m√°me ulo≈æeny n√°zvy podstatn√Ωch konstant. Instanci pak vytv√°≈ô√≠me <code>conf = Config("your_file", keys)</code>, kde "your_file" je n√°zev - nejƒçastƒõji shodn√Ω s n√°zvem projektu. Nap≈ô√≠klad "termostat". Se souborem se pak d√° pracovat nƒõkolika metodami, nap≈ô√≠klad: <code>setup()</code> (interaktivn√≠ m√≥d - pou≈æ√≠v√°me nejƒçastƒõji), <code>create_from_query()</code>, <code>set()</code>, <code>save()</code> ... </p>
<pre><code class="language-python">&gt;&gt;&gt; from config import Config
&gt;&gt;&gt; keys = [&quot;tempMax&quot;,&quot;tempMin&quot;]
&gt;&gt;&gt; conf = Config(&quot;termostat&quot;, keys) # &gt; config/termostat.json
&gt;&gt;&gt; conf.setup()

==================================================
        S E T U P - config/termostat.json
==================================================
[ 1] -          tempMax -
[ 2] -          tempMin -
[q] - Quit from json setup
==================================================
select:

</code></pre>
<p>Vid√≠me, ≈æe nastaven√≠ <code>config</code> je snadn√©. Staƒç√≠ vyplnit nebo modifikovat interaktivn√≠ tabulku.</p>
<p>2) Vytvo≈ôen√≠m pomoc√≠ konstruktoru bez <code>keys</code>: <code>myConfig = Config("myConfigFile")</code></p>
<ul>
<li><code>print_all()</code></li>
<li><code>get("key")</code></li>
<li><code>set("key",value)</code></li>
<li><code>create_from_query("a=1&amp;b=2")</code> # key1 = "a", value1 = 1 ...</li>
<li><code>save()</code></li>
</ul>
<pre><code class="language-python"># vytvo≈ôen√≠ konfigu: a = 1, b = 2
&gt;&gt;&gt; conf = Config(&quot;your_config&quot;)
&gt;&gt;&gt; conf.create_from_query(&quot;a=1&amp;b=2&quot;)
{'a': '1', 'b': '2'}
&gt;&gt;&gt; conf.set(&quot;c&quot;,3)
&gt;&gt;&gt; conf.save()
Writing new config item to file config/your_config.json
&gt;&gt;&gt; conf.print_all()
-----------------------------------------
                  a - 1
                  c - 3
                  b - 2
-----------------------------------------
&gt;&gt;&gt;
</code></pre>
<hr />
<p>Ve sv√©m programu pak <code>config</code> pou≈æijeme n√°sledovnƒõ:</p>
<pre><code class="language-python">from config import Config
conf = Config(&quot;your_config&quot;)
a =  conf.get(&quot;a&quot;) # 1
b =  conf.get(&quot;b&quot;) # 2

</code></pre>
<p>Pro lep≈°√≠ pochopen√≠ datov√Ωch struktur nastudujte ü°í <a href="../ws-python-data/">/ws-python-data</a></p>
<hr />
<h3 id="octopus_lib"><img alt="hwsoc" src="../img/database.png" style="width:28px" /> octopus_lib</h3>
<h4 id="i2c">I2C</h4>
<p><code>i2c_init()</code></p>
<pre><code class="language-python">&gt;&gt;&gt; from utils.octopus_lib import i2c_init
&gt;&gt;&gt; i2c = i2c_init()
&gt;&gt;&gt; i2c.scan()
</code></pre>
<pre><code class="language-python"># I2C address:
OLED_ADDR = 0x3c
LCD_ADDR = 0x27
bhLight = 0x23
bh2Light = 0x5c
tslLight = 0x39

# PCF8574           PCF8574A
# AAA - hex (dec)
# 210
# 000 - 0x20 (32)   0x38 (56)
# 001 - 0x21 (33) * 0x39 (57)
# 010 - 0x22 (34)   0x3A (58)
# 011 - 0x23 (35) * 0x3B (59)
# 100 - 0x24 (36)   0x3C (60)
# 101 - 0x25 (37)   0x3D (61)
# 110 - 0x26 (38)   0x3E (62)
# 111 - 0x27 (39)   0x3F (63)
# * ROBOTboard
</code></pre>
<pre><code class="language-python"># nƒõkter√© dal≈°√≠ z√°kladn√≠ metody
ADDR = 42
i2c.writeto(ADDR, b'123')  # write 3 bytes to slave with 7-bit address 42
i2c.readfrom(ADDR, 8)      # read 8 bytes from slave with 7-bit address 42

i2c.readfrom_mem(ADDR, 8, 3) # ...

</code></pre>
<p>Odkaz na origin√°ln√≠ Micropython dokumentaci k <strong>I2C</strong> ü°í  <a href="https://docs.micropython.org/en/latest/library/machine.I2C.html">https://docs.micropython.org/en/latest/library/machine.I2C.html</a></p>
<hr />
<h4 id="spi">SPI</h4>
<p><code>spi_init()</code></p>
<pre><code class="language-python">from machine import Pin, SPI
from components.display7 import Display7
## from utils.pinout import set_pinout
from utils.octopus_lib import spi_init

print(&quot;--- spi-init ---&quot;)
## spi = SPI(1, baudrate=10000000, polarity=1, phase=0, sck=Pin(pinout.SPI_CLK_PIN), mosi=Pin(pinout.SPI_MOSI_PIN))
spi = spi_init()

ss = Pin(pinout.SPI_CS0_PIN, Pin.OUT)
#spi.deinit() #print(&quot;spi &gt; close&quot;)
...
</code></pre>
<pre><code class="language-python"># nƒõkter√© dal≈°√≠ z√°kladn√≠ metody
SPI.deinit()
SPI.read(nbytes, write=0)
SPI.readinto(buf, write=0)
SPI.write(buf)
SPI.write_readinto(write_buf, read_buf)
...

</code></pre>
<p>Odkaz na origin√°ln√≠ Micropython dokumentaci k <strong>SPI</strong> ü°í <a href="https://docs.micropython.org/en/latest/library/machine.SPI.html">https://docs.micropython.org/en/latest/library/machine.SPI.html</a></p>
<hr />
<h4 id="rtc">RTC</h4>
<p>Modul re√°ln√©ho ƒçasu m√° Micropython v posledn√≠ verzi doplnƒõn i o ntp modulem <code>ntptime</code>.</p>
<p>Co se skr√Ωv√° v ü°í <a href="https://github.com/micropython/micropython/blob/master/ports/esp8266/modules/ntptime.py">ntptime</a>?
P≈ôedev≈°√≠m metoda <code>settime()</code>, pomoc√≠ kter√© z√≠sk√°me p≈ôesn√Ω ƒças ze serveru <code>pool.ntp.org</code>.</p>
<pre><code class="language-python">from ntptime import settime
from machine import RTC
from utils.octopus_lib import w, get_hhmm, setlocal


rtc = RTC()
w() # p≈ôipojen√≠ k internetu
settime()
print(get_hhmm(rtc))

# + 2 h.
setlocal(2)
print(get_hhmm(rtc))

</code></pre>
<p>Zdroj uk√°zky ü°í <a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/examples/test_rtc_ntp.py">test_rtc_ntp.py</a></p>
<p>Odkaz na origin√°ln√≠ Micropython dokumentaci k <strong>RTC</strong> ü°í <a href="https://docs.micropython.org/en/latest/library/machine.RTC.html">https://docs.micropython.org/en/latest/library/machine.RTC.html</a></p>
<hr />
<h3 id="pinout"><img alt="hwsoc" src="../img/database.png" style="width:28px" /> pinout</h3>
<p>Pr√°ci s PINy (<em>"no≈æiƒçky" kontroleru</em>) n√°m ulehƒçuje p≈ôednastanen√Ω <strong>pinout</strong>, kter√Ω je ulo≈æen√Ω v konfiguraƒçn√≠m souboru. Konfiguraƒçn√≠ soubory pro jednotliv√© hw moduly jsou v samostatn√©m adres√°≈ôi <code>/pinouts</code>. Podle toho, jakou m√°me HW platformu, m√°me p≈ôesnƒõ sv√°z√°ny konstanty (ƒç√≠sla PIN≈Ø) s jejich n√°zvy.
Vybran√© soubory zapojen√≠ pin≈Ø jsou na samostatn√© str√°nce ü°í <a href="/pinouts">pinouts</a>.</p>
<p>Zdrojov√Ω k√≥d knihovny: ü°í <a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/utils/pinout.py">utils/pinout</a></p>
<p><strong>Princip je jednoduch√Ω:</strong>
m√°me definov√°ny ƒç√≠seln√© konstanty (v programu se nemƒõn√≠c√≠ ƒç√≠sla), nap≈ô√≠klad pro vestavƒõnou Led diodu: <code>BUILT_IN_LED = const(ƒç√≠slo)</code>. <strong>ƒå√≠slo</strong> je zde ƒç√≠slo PINu a m≈Ø≈æe se li≈°it podle dan√© desky (deska je nastavena p≈ô√≠kazem <code>&gt;&gt;&gt; setup()</code>).
Tato konstanta je ulo≈æena v souborech <code>pinouts/file_name</code>. Pro ROBOTboart je to <code>2</code>, tak≈æe v souboru pro definici pin≈Ø najdete ≈ô√°dek <code>BUILT_IN_LED = const(2)</code>. V√Ωchoz√≠ spoleƒçn√© piny jsou v <a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/pinouts/olab_esp32_base.py">/pinouts/olab_esp32_base.py</a> a ROBOTboard je p≈ôeb√≠r√°.</p>
<p>Jak se s modulem pinout pracuje? M≈Ø≈æete si zkusit z termin√°lu Micropythonu: <code>&gt;&gt;&gt;</code></p>
<pre><code class="language-python">&gt;&gt;&gt; from utils.pinout import set_pinout
&gt;&gt;&gt; pinout = set_pinout()
</code></pre>
<p>A u≈æ m√°me dostupn√© piny na <code>pinout.NAZEV_PINU</code>, daj√≠ se zjistit i osatn√≠ PINy, po <code>pinout</code> teƒçka <code>TAB</code>:</p>
<pre><code class="language-python">&gt;&gt;&gt; pinout.
__class__       __name__        const           __file__
WS_LED_PIN      ONE_WIRE_PIN    PIEZZO_PIN      MOTOR_12EN
MOTOR_34EN      MOTOR_1A        MOTOR_2A        MOTOR_3A
MOTOR_4A        ANALOG_PIN      PWM1_PIN        PWM2_PIN
PWM3_PIN        SERVO_MIN       SERVO_MAX       I39_PIN
DEV1_PIN        DEV2_PIN        BUILT_IN_LED    HALL_SENSOR
I2C_SCL_PIN     I2C_SDA_PIN     SPI_CLK_PIN     SPI_MISO_PIN
SPI_MOSI_PIN    SPI_CS0_PIN     RXD0            TXD0
BUTT1_PIN       BUTT2_PIN       BUTT3_PIN       DEV3_PIN
...

&gt;&gt;&gt; pinout.BUILT_IN_LED
2
</code></pre>
<p>Vid√≠me, ≈æe pro <code>BUILT_IN_LED</code> n√°m "dohled√°" ƒç√≠slo deklarovan√© <code>2</code>, tak≈æe se to d√° pou≈æ√≠t:</p>
<pre><code class="language-python">led = Led(pinout.BUILT_IN_LED)      # BUILT_IN_LED = 2
</code></pre>
<p>je shodn√© s:</p>
<pre><code class="language-python">led = Led(2)
</code></pre>
<p>ale ƒç√≠slo <code>2</code> si nemus√≠me pamatovat, nav√≠c u r≈Øzn√Ωch modul≈Ø se m≈Ø≈æe li≈°it.</p>
<p><em>Cel√° uk√°zka pro blik√°n√≠ vestavƒõn√© Ledky na r≈Øzn√Ωch modulech - m≈Ø≈æe b√Ωt na PINu <code>2</code> nebo tak√© na <code>15</code>... nebo √∫plnƒõ jin√©m.
A my toto ƒç√≠slo p≈ôi spr√°vn√© konfiguraci modulu (desky) nemus√≠me ≈ôe≈°it a k vestavƒõn√© Ledce p≈ôistupujeme n√°zvem PINu: <code>BUILT_IN_LED</code>.</em></p>
<pre><code class="language-python">from components.led import Led
from utils.pinout import set_pinout   # import library

pinout = set_pinout()   # set board pinout

led = Led(pinout.BUILT_IN_LED)

# start main loop
while True:
    led.blink()
</code></pre>
<p>ü°í <a href="#led">Led</a></p>
<hr />
<h3 id="dekorator"><img alt="hwsoc" src="../img/database.png" style="width:28px" /> Dekor√°tor</h3>
<p>Mo≈æn√° jste si v nƒõkter√Ωch na≈°ich uk√°zk√°ch v≈°imnuli speci√°ln√≠ho pou≈æit√≠ <code>@</code> p≈ôed definic√≠ funkce, nap≈ô√≠klad v ü°í <a href="#pubsub">pubsub</a></p>
<pre><code class="language-python">@pubsub.subscriber(&quot;value&quot;)
def display_num(value):
    d7.show(value)
</code></pre>
<p>nebo v ü°í <a href="#button">button</a></p>
<pre><code class="language-python">@led_button.on_press
def on_press_top_button():
    print(&quot;on_press_top_button&quot;)
    built_in_led.on()
</code></pre>
<p>Dekor√°tor v Pythonu je <strong>funkce</strong>, kter√° dostane jeden argument (funkci) a vr√°t√≠ jednu hodnotu - opƒõt funkci, kter√° je modifikovanou verz√≠ funkce p≈Øvodn√≠. <em>P≈Øvodn√≠ funkce ja takzvanƒõ "odekorovan√°".</em></p>
<p>Pou≈æit√≠ dekor√°tor≈Ø velmi zjednodu≈°√≠ a zp≈ôehlen√≠ v√°≈° k√≥d. Pou≈æ√≠v√° se na registraci, modifikaci a podobnƒõ. </p>
<pre><code class="language-python">@dekorator
def funkce():
    pass

# je stejn√© jako:

def funkce():
    pass
funkce = dekorator(funkce)
</code></pre>
<p>Speci√°ln√≠ <code>@octopus_debug</code> dekor√°tor ü°í <a href="https://github.com/octopusengine/octopuslab/blob/master/esp32-micropython/utils/octopus_decor.py">/octopus_decor.py</a> vrac√≠ nap≈ô√≠klad ƒças, kter√Ω trvalo proveden√≠ "odekorovan√©" funkce.</p>
<pre><code class="language-python">@octopus_debug
def yourFunc(): 
    ...
</code></pre>
<hr />
<h3 id="zrychleni-prace-procesoru">Zrychlen√≠ pr√°ce procesoru</h3>
<p>Zkou≈°√≠me dekor√°tory <code>@micropython.native</code> nebo <code>@micropython.viper</code> - podrobnƒõji pops√°no p≈ô√≠mo na str√°nk√°ch ü°í <a href="http://docs.micropython.org/en/v1.9.3/pyboard/reference/speed_python.html">micropython/reference/..speed_python</a></p>
<p>Jak se d√° rychlost testovat (je pou≈æit dal≈°√≠ dekor√°tor <code>@octopus_debug</code> - ten vrac√≠ ƒças bƒõhu funkce):</p>
<pre><code class="language-python">from utils.octopus_decor import octopus_debug


@octopus_debug
def test1():
    for i in range(10000000):
        xx=i

@octopus_debug
@micropython.native
def test2_native():
    for i in range(10000000):
        xx=i

@octopus_debug
@micropython.viper
def test3_viper():
    for i in range(10000000):
        xx=i



&gt;&gt;&gt; test1()
=== function name:  test1
=== duration (sec.) ---&gt; 41

...

&gt;&gt;&gt; test2_native()
=== function name:  test2
=== duration (sec.) ---&gt; 6

...

test3_viper()
</code></pre>
<hr />
<h2 id="web-server-ide-jednoduche-ovladani">Web server - IDE - jednoduch√© ovl√°d√°n√≠</h2>
<p>Jsme vyƒçlenili samostatnƒõ - zat√≠m zde: <a href="https://www.octopuslab.cz/micropython-web-ide/">micropython-web-ide</a></p>
<h3 id="web-server">Web server</h3>
<p>ESP32 m√° dostateƒçn√Ω v√Ωkon, aby na nƒõm mohl bƒõ≈æet jednoduch√Ω <strong>webov√Ω server</strong> (server s jednoduch√Ωmi "html" str√°nkami, k kter√©mu se v lok√°ln√≠ s√≠ti p≈ôipoj√≠me p≈ôes IP ESPƒçka)</p>
<pre><code class="language-python">&gt;&gt;&gt; from utils.octopus_lib import w
&gt;&gt;&gt; from utils.octopus import web_server
&gt;&gt;&gt; w()
&gt;&gt;&gt; web_server()

</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../setup/" class="btn btn-neutral float-left" title="Setup (nastaven√≠)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../pinouts/" class="btn btn-neutral float-right" title="Pinouts">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>CC-BY</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/octopuslab-cz/docs_octopuslab_cz" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../setup/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../pinouts/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
